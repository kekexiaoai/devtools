# React 重构笔记：精通无障碍访问性 (a11y)

本文档旨在深入解析两个非常核心的 Web Accessibility (a11y) 属性：`tabIndex` 和 `onKeyDown` 事件处理器。在我们为了解决 HTML 嵌套问题，将一个 `<Button>` 替换为 `<span>` 后，正是这两个属性，让我们的 `<span>` 真正地“活”了起来，变得对所有用户都可用。

## 1. `tabIndex={0}` 的魔力：让元素“可被触及”

> “`tabIndex={0}` 这个是什么意思？”

### **教学：键盘的“导航之旅”**

想象一下，一个只使用键盘的用户（比如视力障碍者，或手部有残疾的“大佬”级程序员）是如何与我们的应用交互的。他们会反复地按 **`Tab`** 键，让焦点在页面上所有**可交互**的元素之间依次跳转。

- **默认的“可交互”元素**: 在 HTML 的世界里，只有少数几种元素天生就是“可交互”的，比如 `<a>` (链接), `<button>` (按钮), `<input>` (输入框)。当您按 `Tab` 键时，焦点会自然地在它们之间移动。
- **被“遗忘”的元素**: 而像 `<div>`, `<span>`, `<p>` 这样的元素，默认是**不可交互**的。键盘的焦点会直接“跳过”它们。

`tabIndex` 属性正是我们用来改变这个默认行为的工具。

- **`tabIndex="-1"`**: 让一个元素变得“**可通过代码聚焦**”，但**不会**出现在 `Tab` 键的导航序列中。这通常用于我们需要用 JavaScript (`element.focus()`) 来手动管理焦点的复杂组件。
- **`tabIndex="0"`**: 这是最常用的值。它将一个原本不可交互的元素（比如我们的 `<span>` 关闭按钮），**加入到 `Tab` 键的自然导航序列中**。它等于是在告诉浏览器：“嘿，虽然它是个 `<span>`，但在用户按 `Tab` 键时，请不要跳过它，在这里停一下。”

**结论**: 我们为关闭图标的 `<span>` 添加 `tabIndex={0}`，是为了让只使用键盘的用户，也能够通过按 `Tab` 键，将焦点定位到这个“X”上。

## 2. `onKeyDown` 的职责：教会 `<span>` 如何“响应”

> “`onKeyDown={...}` 这个是什么作用？”

仅仅让 `<span>` 能被聚焦是远远不够的。当用户将焦点停在它上面后，他们期望能像操作一个真正的按钮一样，通过按**键盘**来“激活”它。

### **教学：按钮的“通用语言”**

在所有的操作系统和浏览器中，按钮都遵循一个通用的交互契约：

- 可以用**鼠标点击**来激活。
- 也可以在被键盘聚焦后，用 **`Enter` (回车键)** 或 **`Spacebar` (空格键)** 来激活。

我们的 `<span>` 元素，即便被聚焦了，它本身也是“愚笨”的。它不知道当用户按下 `Enter` 或 `Spacebar` 时应该做什么。`onKeyDown` 事件处理器，正是我们用来**“教会”**它这个行为的。

**我们代码的逐行解析**:

```tsx
onKeyDown={(e) => {
  // 1. 我们只关心 Enter 和空格键
  if (e.key === ' ' || e.key === 'Enter') {
    // 2. 阻止默认行为。
    //    对于空格键，这可以防止按下它时页面意外地向下滚动。
    e.preventDefault();
    // 3. 阻止事件冒泡。
    //    这确保了激活这个“X”按钮，不会意外地也触发父级 <TabsTrigger> 的点击事件。
    e.stopPropagation();
    // 4. 执行与 onClick 完全相同的逻辑
    onCloseTerminal(session.id);
  }
}}
```

### 总结：三位一体，铸就完美“伪装”

`role="button"`, `tabIndex={0}` 和 `onKeyDown` 这三个属性，像三位一体的“特种兵”，共同协作，将我们一个普通的 `<span>` 元素，完美地“伪装”成了一个功能完备、对所有用户都友好的 `<button>`：

- **`role="button"`**: 告诉**屏幕阅读器**：“这是一个按钮”。
- **`tabIndex={0}`**: 告诉**键盘**：“你可以通过 `Tab` 键访问到我”。
- **`onKeyDown`**: 告诉**交互逻辑**：“当 `Enter` 或 `Spacebar` 被按下时，请执行和‘点击’一样的操作”。

这就是我们在前端开发中，实现**无障碍访问性 (a11y)** 的核心思想。
