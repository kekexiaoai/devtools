# 📜 JavaScript 模块世界的“双龙决”——CJS、ESM 与 JS 的爱恨情仇

> **前言：** 在 Node.js 的江湖里，一直有两大宗师门派，它们用各自的独门心法，定义着代码模块之间如何“传功”与“承招”。理解它们的区别，是每一位深入此道的修行者必须完成的试炼。

---

## 👴 **CommonJS (CJS) - “元老宗师”**

**门派画像：**
一位功力深厚、稳重可靠的老前辈。他开创了 Node.js 服务端模块化的先河，一招一式都显得那么经典、直观。

**独门心法：**

- **传功口诀 (`export`)**: `module.exports = { ... }`
- **承招口诀 (`import`)**: `const myModule = require('./myModule.cjs')`

**武功特点：**

- **一板一眼 (同步加载)**: 当你 `require` 一个模块时，整个世界都会为你停下，直到那个模块的功力全部传输完毕。简单粗暴，但非常可靠。
- **随心所欲 (动态加载)**: 你可以在任何需要的时候，甚至在条件判断句里，才决定是否要 `require` 一位外援。

**专属信物：** `.cjs`

> 当一个文件佩戴上 `.cjs` 这个信物时，它就是在宣告天下：“我乃 CommonJS 正统传人，闲杂人等（尤其是 ESM）休得用别的规矩来对我指手画脚！”

---

## ✨ **ES Modules (ESM) - “后起之秀”**

**门派画像：**
一位天赋异禀、身法飘逸的年轻天才。他是 JavaScript 官方钦定的未来继承人，招式华丽且威力巨大，尤其擅长轻功（性能优化）。

**独门心法：**

- **传功口诀 (`export`)**: `export function myFunction() { ... }` 或 `export default ...`
- **承招口诀 (`import`)**: `import { myFunction } from './myModule.mjs'`

**武功特点：**

- **身法如风 (异步加载)**: 他的加载过程是非阻塞的，就像一阵风，不会因为等待某个模块而卡住整个世界的运行。
- **预判宗师 (静态解析)**: 他要求所有 `import` 和 `export` 都必须在代码的最外层声明。这看似是限制，实则赋予了他“预判”的能力，可以在代码运行前就看清所有内力（代码）的流向。
- **独门绝技 - “摇树功” (Tree Shaking)**: 基于“预判”能力，他可以在最终打包时，将那些你 `import` 了但从没用过的“死内力”（dead code）全部抖掉，让你最终的功法（产物）变得异常轻盈、纯粹！

**专属信物：** `.mjs`

> 佩戴 `.mjs` 信物的文件，其身份同样不容置疑。它高调地展示着自己 ESM 新贵血统，与 CJS 老派划清界限。

---

## 🤔 **`.js` - “摇摆不定的弟子”**

**画像：**
一个没有专属信物的普通弟子。他究竟是拜入 CJS 老前辈门下，还是追随 ESM 新天才，完全不取决于他自己，而是取决于他所在道场的“馆规”。

**“馆规” (`package.json`):**
这个弟子的命运，由 `package.json` 文件里的 `type` 字段所决定：

- **馆规一 (默认)**: `package.json` 里**没有** `"type": "module"`。
  - **结果**: 这位 `.js` 弟子默认**拜入 CJS 门下**，遵循老前辈的 `require/exports` 规矩。
- **馆规二 (新潮)**: `package.json` 里**明确**写着 `"type": "module"`。
  - **结果**: 这位 `.js` 弟子则被要求**追随 ESM 新星**，必须使用 `import/export` 心法。

> **核心要义：** `.cjs` 和 `.mjs` 的身份是绝对的，而 `.js` 的身份是相对的。

---

### **终极备忘录：“一图流”掌握门派身份**

| 信物 / 文件 | 所属门派        | 内功特点 | 独门心法                    | 身份判定                          |
| :---------- | :-------------- | :------- | :-------------------------- | :-------------------------------- |
| **`.cjs`**  | CommonJS (CJS)  | 同步稳重 | `require`, `module.exports` | **绝对**                          |
| **`.mjs`**  | ES Module (ESM) | 异步轻快 | `import`, `export`          | **绝对**                          |
| **`.js`**   | **看情况**      | 看情况   | 看情况                      | **相对** (由 `package.json` 决定) |

---

> **后记：** 理解这场“双龙决”，你便能在现代前端工程化的复杂江湖中游刃有余，无论是配置 Webpack、Vite、ESLint 还是 `lint-staged`，都能一眼看穿其模块依赖的本质，不再为那些神秘的报错而困惑。
